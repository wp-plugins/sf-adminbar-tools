if (!(window.console && console.log)){(function(){var noop=function(){};var methods=['assert','clear','count','debug','dir','dirxml','error','exception','group','groupCollapsed','groupEnd','info','log','markTimeline','profile','profileEnd','markTimeline','table','time','timeEnd','timeStamp','trace','warn'];var length=methods.length;var console=window.console={};while(length--){console[methods[length]]=noop;}}());}(function($){$.fn.hoverIntentOn=function(f,g){var cfg={sensitivity:7,interval:100,timeout:0,delegate:null};cfg=$.extend(cfg,g?{over:f,out:g}:f);var cX,cY,pX,pY;var track=function(ev){cX=ev.pageX;cY=ev.pageY;};var compare=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);if((Math.abs(pX-cX)+Math.abs(pY-cY))<cfg.sensitivity){$(ob).off("mousemove",cfg.delegate,track);ob.hoverIntent_s=1;return cfg.over.apply(ob,[ev]);}else{pX=cX;pY=cY;ob.hoverIntent_t=setTimeout(function(){compare(ev,ob);},cfg.interval);}};var delay=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);ob.hoverIntent_s=0;return cfg.out.apply(ob,[ev]);};var handleHover=function(e){var ev=jQuery.extend({},e);var ob=this;if(ob.hoverIntent_t){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);}if(e.type=="mouseenter"){pX=ev.pageX;pY=ev.pageY;$(ob).on("mousemove",track);if(ob.hoverIntent_s!=1){ob.hoverIntent_t=setTimeout(function(){compare(ev,ob);},cfg.interval);}}else{$(ob).off("mousemove",track);if(ob.hoverIntent_s==1){ob.hoverIntent_t=setTimeout(function(){delay(ev,ob);},cfg.timeout);}}};return this.on('mouseenter',cfg.delegate,handleHover).on('mouseleave',cfg.delegate,handleHover);};})(jQuery);(function($){$.fn.abtLoader=function(){return this.after('<span class="loader">&#160;</span>');};})(jQuery);(function($){$.fn.fadeInRemove=function(){return this.fadeIn(function(){$(this).remove();});};})(jQuery);(function($){$.fn.slideUpRemove=function(){return this.animate({'height':0},300,function(){$(this).remove();});};})(jQuery);(function($){$.fn.abtRemoveLoader=function(){return this.blur().next('.loader').fadeInRemove();};})(jQuery);(function($){$.fn.abtAddClone=function($clr_btn,avatar){var $clone=this.addClass('used-by-me').clone(true).height(0).attr('id',function(i,val){return val+'-own';});$clone.children('.loader').remove();$clone.insertBefore($clr_btn).animate({'height':'26px'},300);if(typeof avatar!='undefined'&&avatar!=='')$clone.children('.ab-item').prepend(avatar);return this;};})(jQuery);jQuery(document).ready(function($){var abt={$body:$("body"),$bar:$(document.getElementById('wpadminbar')),$tools:$(document.getElementById('wp-admin-bar-sf-abt-tools')),$files_dd:$(document.getElementById('wp-admin-bar-sf-abt-files')),$clr_btn:$(document.getElementById('wp-admin-bar-sf-abt-close-files')),open_files:'',refc:'',forceload:'&force=1',events:0,log:function(code){var msgs={noConnexion:'Error: can\'t establish a connexion :/',unkownError:'The server told me there\'s an error somewhere :s',badResponse:'Error: bad response from the server',noLocalStorage:'Your browser does not support localStorage. The small adminbar and the floated admin menu will not be saved between pages.'};if(typeof msgs.code=='string')console.log(msgs[code]);else console.log(code);},hoverIntent:function(){if(typeof(jQuery.fn.hoverIntent)!="undefined")abt.$files_dd.find("li.menupop").off('mouseover mouseout');abt.$bar.hoverIntentOn({over:function(c){$(this).addClass("hover");},out:function(c){$(this).removeClass("hover");},delegate:"#wp-admin-bar-sf-abt-files li.menupop",timeout:180,sensitivity:7,interval:100});},refresh_counters:function(){$.ajax({type:'post',url:sfabt.ajax_url+'?action=sf_abt_refresh_counters&nonce='+sfabt.refresh_counters_nonce,dataType:"json"}).done(function(data){if(data&&typeof data=='object'){abt.update_counters(data.me,data.other);sfabt.cowork=parseInt(data.cowork,10)?'start':'stop';if(sfabt.cowork&&!abt.events)abt.cowork_events();}}).fail(function(){abt.log('noConnexion');});},update_counters:function(me,other){var $my_counters=abt.$tools.find('.used-by-me-counter');var $other_counters=abt.$tools.find('.used-by-other-counter');if(!me)$my_counters.remove();else{if(!$my_counters.length){$('<span id="used-by-me-small" class="hidden-when-not-small used-by-me-counter">'+me+'</span>').insertAfter('#wp-admin-bar-sf-abt-close-files .sf-abt-stats');$('<span id="used-by-me" class="used-by-me-counter">'+me+'</span>').insertAfter('#wp-admin-bar-sf-abt-main > .ab-item .sf-abt-stats');}else $my_counters.text(me);}if(!other)$other_counters.remove();else{if(!$other_counters.length){$('<span id="used-by-other-small" class="hidden-when-not-small used-by-other-counter">'+other+'</span>').appendTo('#wp-admin-bar-sf-abt-close-files > .ab-item');$('<span id="used-by-other" class="used-by-other-counter">'+other+'</span>').appendTo('#wp-admin-bar-sf-abt-main > .ab-item > .hidden-when-small');}else $other_counters.text(other);}},update_top_counters:function(){var $counter_me=$(document.getElementById('used-by-me'));var $counter_other=$(document.getElementById('used-by-other'));var $counter_me_small=$(document.getElementById('used-by-me-small'));var $counter_other_small=$(document.getElementById('used-by-other-small'));if(!$counter_me_small.length)$counter_me.remove();else{if(!$counter_me.length)$counter_me=$('<span id="used-by-me" class="used-by-me-counter">0</span>').insertAfter('#wp-admin-bar-sf-abt-main > .ab-item .sf-abt-stats');$counter_me.text($counter_me_small.text());}if(!$counter_other_small.length)$counter_other.remove();else{if(!$counter_other.length)$counter_other=$('<span id="used-by-other" class="used-by-other-counter">0</span>').appendTo('#wp-admin-bar-sf-abt-main > .ab-item > .hidden-when-small');$counter_other.text($counter_other_small.text());}},increment_my_counters_by:function(i){var $counter=$(document.getElementById('used-by-me'));var $counter_small=$(document.getElementById('used-by-me-small'));if(!$counter.length)$counter=$('<span id="used-by-me" class="used-by-me-counter">0</span>').insertAfter('#wp-admin-bar-sf-abt-main > .ab-item .sf-abt-stats');if(!$counter_small.length)$counter_small=$('<span id="used-by-me-small" class="hidden-when-not-small used-by-me-counter">0</span>').insertAfter('#wp-admin-bar-sf-abt-close-files .sf-abt-stats');var counterVal=parseInt($counter.text(),10)+parseInt(''+i,10);if(!counterVal){$counter.remove();$counter_small.remove();}else{$counter.text(counterVal);$counter_small.text(counterVal);}},refresh_cowork_tree:function(){$.ajax({type:'post',url:sfabt.ajax_url+'?action=sf_abt_refresh_files&nonce='+sfabt.refresh_files_nonce+abt.forceload+'&cowork='+sfabt.cowork,data:{files:abt.open_files},dataType:"json",beforeSend:function(){$(document.getElementById('wp-admin-bar-sf-abt-coworking')).find('.ab-item').abtLoader();}}).done(function(data){if(typeof data=='object'&&data!==null&&typeof data.files!='undefined'){if(data.files=='stop'){abt.forceload='&force=1';$(document.getElementById('wp-admin-bar-sf-abt-coworking')).children().text(sfabt.cowork_on).parent().siblings().slideUpRemove();abt.update_counters(0,0);sfabt.cowork='stop';if(abt.events)abt.cowork_events();}else if(data.files=='not modified'){}else if(typeof data.html!='undefined'){abt.$files_dd.replaceWith(data.html);abt.open_files=data.files;abt.$files_dd=abt.$tools.find('#wp-admin-bar-sf-abt-files').addClass('ab-submenu').removeClass('ab-top-menu');abt.$clr_btn=abt.$files_dd.find('#wp-admin-bar-sf-abt-close-files');abt.update_top_counters();abt.forceload='';sfabt.cowork='start';if(!abt.events)abt.cowork_events();}else{var $dirs=abt.$files_dd.children('.sf-abt-root-directory');var $mylist=abt.$files_dd.children('.used-by-me').find('.ab-item');var me_c=0;var other_c=0;for(var file in data.files){if(data.files[file]==sfabt.mid)me_c++;else other_c++;if(typeof abt.open_files[file]!='undefined'&&data.files[file]==abt.open_files[file]){delete(abt.open_files[file]);continue;}var file_title=file.split(sfabt.content_dir).join('');if(data.files[file]==sfabt.mid){var $my_file=$dirs.find('[title="'+file_title+'"]').parent();$my_file.find('.avatar').remove();$my_file.removeClass('used-by-other');var avatar=typeof data.avatars!='undefined'&&typeof data.avatars[data.files[file]]!='undefined'?data.avatars[data.files[file]]:'';$my_file.abtAddClone(abt.$clr_btn,avatar);}else{var $other_file=$dirs.find('[title="'+file_title+'"]').parent().removeClass('used-by-me');$mylist.filter('[title="'+file_title+'"]').parent().slideUpRemove();$other_file.addClass('used-by-other');if(typeof data.avatars!='undefined'&&typeof data.avatars[data.files[file]]!='undefined'&&data.avatars[data.files[file]]!==''&&!$other_file.children('.ab-item').children('.avatar').length){$other_file.children('.ab-item').prepend(data.avatars[data.files[file]]);}}}for(var oldFile in abt.open_files){var oldFile_title=oldFile.split(sfabt.content_dir).join('');var $oldFile=$dirs.find('[title="'+oldFile_title+'"]').parent();$oldFile.find('.avatar').remove();$oldFile.removeClass('used-by-me used-by-other');$mylist.filter('[title="'+oldFile_title+'"]').parent().slideUpRemove();}abt.update_counters(me_c,other_c);abt.open_files=data.files;}}}).fail(function(){abt.log('noConnexion');}).always(function(){$(document.getElementById('wp-admin-bar-sf-abt-coworking')).find('.loader').fadeInRemove();});},cowork_events:function(){if(sfabt.cowork=='start'){abt.$tools.on('click','#wp-admin-bar-sf-abt-files .abt-file .ab-item',function(e){var $this=$(this);var filepath=$this.attr('title');$.ajax({type:'post',url:sfabt.ajax_url+'?action=sf_abt_update_open_files&nonce='+sfabt.update_files_none,data:{"file":filepath},dataType:"json",beforeSend:function(){$this.abtLoader();}}).done(function(data){if(typeof data.msg=='string'){if(typeof data.files!='undefined')abt.open_files=data.files;if(data.msg=='you-got-it-my-young-padawan'){var avatar=typeof data.avatar=='string'?data.avatar:'';$this.parent().abtAddClone(abt.$clr_btn,avatar);abt.increment_my_counters_by(1);}else if(data.msg=='i-m-not-a-number'){var path=$this.attr('title');abt.$files_dd.find('.sf-abt-root-directory .used-by-me .ab-item').filter('[title="'+path+'"]').parent().removeClass('used-by-me');$this.parent().slideUpRemove();abt.increment_my_counters_by(-1);}else if(data.msg=='you-shall-not-pass'){if(!$this.parent().hasClass('used-by-other')){$this.parent().addClass('used-by-other');if(typeof data.avatar=='string'){if(data.avatar!=='')$this.prepend(data.avatar);}}}else{abt.log('unknownError');}}else abt.log('badResponse');}).fail(function(){abt.log('noConnexion');}).always(function(){$this.abtRemoveLoader();});e.preventDefault();}).on('click','#wp-admin-bar-sf-abt-close-files .ab-item',function(e){var $this=$(this);$.ajax({type:'post',url:sfabt.ajax_url+'?action=sf_abt_close_all_my_files&nonce='+sfabt.close_files_nonce,beforeSend:function(){$this.abtLoader();}}).done(function(data){if(data=='removed'){abt.$files_dd.find('.used-by-me').removeClass('used-by-me');$this.parent().siblings('.abt-file').slideUpRemove();$('#used-by-me, #used-by-me-small').remove();}else abt.log('unkownError');}).fail(function(){abt.log('noConnexion');}).always(function(){$this.abtRemoveLoader();});e.preventDefault();}).on('mouseenter','#wp-admin-bar-sf-abt-main > .ab-item',function(e){abt.refresh_cowork_tree();e.preventDefault();}).on('mouseenter','.menupop',function(e){$(this).each(function(){var $this=$(this);var $window=$(window);var $wrap=$this.children('.ab-sub-wrapper');var offtop=$this.offset().top-$window.scrollTop();var wraph=$wrap.outerHeight();var wrapb=$wrap.css('bottom');if((offtop!=73)&&(offtop-wraph<0)&&(offtop+wraph>$window.height())){$wrap.css({'top':function(){return 73-offtop;},'bottom':'auto'});}else if((wrapb!='7px')&&(offtop-wraph>0)&&(offtop+wraph>$window.height())){$wrap.css({'bottom':-7,'top':'auto'});}else if(wrapb!='auto'){$wrap.css({'bottom':'auto','top':'auto'});}});});abt.refc=setInterval(abt.refresh_counters,300000);abt.events=1;}else if(sfabt.cowork=='stop'){abt.$tools.off('click mouseenter','**');abt.refc=clearInterval(abt.refc);abt.events=0;}},init:function(){if(window.localStorage){if(localStorage.getItem('smallAdminBar'))abt.$body.addClass("admin-bar-small");if(abt.$body.hasClass('wp-admin')&&localStorage.getItem('fixedAdminMenu'))abt.$body.addClass("admin-menu-fixed");window.onunload=function(){if(abt.$body.hasClass("admin-bar-small")){localStorage.setItem('smallAdminBar',1);}else{localStorage.removeItem('smallAdminBar');}if(abt.$body.hasClass('admin-menu-fixed')){localStorage.setItem('fixedAdminMenu',1);}else if(abt.$body.hasClass('wp-admin')){localStorage.removeItem('fixedAdminMenu');}};}else{abt.log('noLocalStorage');}abt.$bar.on('click','#wp-admin-bar-sf-abt-main>.ab-item',function(e){abt.$body.toggleClass('admin-bar-small');e.preventDefault();});if(abt.$body.hasClass('wp-admin')){abt.$bar.on('click','#wp-admin-bar-sf-abt-menuWpQuery > .ab-item',function(e){abt.$body.toggleClass('admin-menu-fixed');e.preventDefault();});}else{abt.$body.on('click','#wp-admin-bar-sf-abt-menuWpQuery > .ab-item, #sf-abt-h2',function(e){var $preWrap=$(document.getElementById('sf-abt-pre-wrap'));if($preWrap.length&&$preWrap.hasClass('is-404')){$preWrap.show();}else{var $preCont=$(document.getElementById('sf-abt-pre-cont'));if(!$preCont.length)$preCont=$('<div id="sf-abt-pre-cont"/>').appendTo(abt.$body);var sep='?';var pageUrl=window.location.href;if(pageUrl.indexOf('#')!=-1)pageUrl=pageUrl.split('#')[0];if(pageUrl.indexOf('?')!=-1)sep='&';$preCont.html('').load(pageUrl+sep+'_wpnonce='+sfabt.query_nonce+'&wp_query #sf-abt-pre-wrap');}e.preventDefault();}).on('click','#sf-abt-pre-wrap',function(e){if(e.target===this){var $this=$(this);if($this.hasClass('is-404'))$this.hide();else $this.parent().remove();e.preventDefault();}});}abt.$tools.on('click, focus','input.no-adminbar-style',function(e){var $this=$(this);var oldValue=this.defaultValue;var nbr_params=$this.data('nbrparams');var newValue="add_action( '"+oldValue+"', ''"+(nbr_params!='undefined'&&nbr_params>1?", 10, "+nbr_params:"")+" );";var initwidth=$this.width();$this.val(newValue).data('initwidth',initwidth).css('width',function(){return $this.parent().width();});this.select();}).on('blur','input.no-adminbar-style',function(e){var $this=$(this);var newValue=this.defaultValue;$this.val(newValue).css('width',function(){return $this.data('initwidth');}).removeData('initwidth');});$(window).on('focus',function(e){if(abt.forceload)abt.refresh_counters();else abt.refresh_cowork_tree();});abt.$bar.on('click','#wp-admin-bar-sf-abt-coworking .ab-item',function(e){var $this=$(this);$.ajax({type:'post',url:sfabt.ajax_url+'?action=sf_abt_enable_coworking&nonce='+sfabt.coworking_nonce,beforeSend:function(){$this.abtLoader();}}).done(function(data){if(data=='start'){sfabt.cowork='start';if(!abt.events)abt.cowork_events();abt.refresh_cowork_tree();}else{abt.forceload = '&force=1';$this.text(sfabt.cowork_on).parent().siblings().slideUpRemove();abt.update_counters(0,0);sfabt.cowork='stop';if(abt.events)abt.cowork_events();}}).fail(function(){abt.log('noConnexion');}).always(function(){$this.abtRemoveLoader();});e.preventDefault();});abt.hoverIntent();if(!abt.events)abt.cowork_events();}};abt.init();});